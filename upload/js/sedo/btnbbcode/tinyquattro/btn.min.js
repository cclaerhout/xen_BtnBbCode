xenMCE.Templates.Bbm_adv_button={onafterload:function(n,t,i){var c=n.find("input[name=text]"),w=n.find("input[name=style]"),k=n.find("input[name=style_bgcolor]"),d=n.find("input[name=style_color]"),p=n.find("input[name=style_color_model]"),y="...",e=c.val(),u=n.find(".bbm_button"),f=n.find(".bbm_button.adv_cstm"),v=n.find(".FontColor"),s="FFFFFF",h="000000",o;e&&e!=y&&u.text(e);var g=function(n){if(n.search("rgb")==-1)return n;n=n.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/);function t(n){return("0"+parseInt(n).toString(16)).slice(-2)}return"#"+t(n[1])+t(n[2])+t(n[3])},b=function(n){return n.replace("#","")},a=function(n){var t=n.css("backgroundColor"),r=s,u,i;typeof t!="undefined"&&t!="transparent"&&(r=b(g(t))),u=$.colpickHexToHsb(r),i=h,u.b<50&&t!="transparent"&&(i=s),$('<i class="mce-ico mce-i-selected"></i>').css("color","#"+i).prependTo(n)},l=function(n,t){var e="#"+t,u=h;n.b<50&&(u=s),f.css({backgroundColor:e,color:"#"+u}).find("i").css("color","#"+u),k.val(e)};f.colpick({colorScheme:"dark",layout:"hex",color:"ff8800",onChange:function(n,t,i,r){var f=$(r);l(n,t,i,f)},onSubmit:function(n,t,i,r){var u=$(r);l(n,t,i,u),u.colpickHide()},onShow:function(n){var t=$(n),i=t.height()+f.height()+20;t.css({zIndex:65550,top:"-="+i})}}),o=function(t,i){var e=n.find(".bbm_button.active"),f="#"+i;e.css("color",f),d.val(f),p.val(e.data("model"))},v.colpick({colorScheme:"dark",layout:"hex",color:"ff8800",onSubmit:function(n,t,i,r){var u=$(r);o(n,t,i,u),u.colpickHide()},onChange:function(n,t,i,r){var f=$(r);o(n,t,i,f)},onShow:function(t){var e=$(t),o=n.find(".bbm_button.active"),h=e.height()+f.height()+20,s=u.width(),r;if(!o.length)return r=v.data("alert")||"",i.windowManager.alert(r),!1;e.css({zIndex:65550,top:"-="+h,left:"+="+s})}});c.on("change, keydown, keyup",function(){var i=$(this).val();i?u.text(i):u.each(function(){var n=$(this);n.text(n.data("phrase"))}),a(n.find(".bbm_button.active"))}).one("click",function(){var n=$(this);n.val()==y&&n.val("")});u.click(function(){var n=$(this);u.removeClass("active"),u.children("i").remove(),n.addClass("active"),a(n),w.val(n.data("model"))})},submit:function(n,t,i,r){var a=r.bbm_tag,y=r.bbm_separator,u=n.data,p=u.blockalign,c=parseInt(u.btnBlock),e=u.style,h=u.style_bgcolor,b=u.style_color,w=u.style_color_model,v=u.text,s=u.url,l=parseInt(u.urlHref),f=[],o;e.length&&(e=="cstm"&&h.length?f.push(h):e!="cstm"&&f.push(e)),c&&f.push(p),s.length&&(f.push(s),l&&f.push("self")),o=r.escapeHtml(v),w==e&&(o='<span style="color: '+b+';">'+o+"</span>"),f=f.join(y),r.insertBbCode(a,f,o);return},onclose:function(n,t){t.find(".custColorPicker").each(function(){var n=$(this).data("colpickId");n&&$("#"+n).remove()})}};